(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{367:function(t,a,s){"use strict";s.r(a);var n=s(29),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ijpay-中的微信支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ijpay-中的微信支付","aria-hidden":"true"}},[t._v("#")]),t._v(" IJPay 中的微信支付")]),t._v(" "),s("h2",{attrs:{id:"官方参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官方参考文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 官方参考文档")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("普通商户模式接入"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/sl.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式接入"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/pap_sl.php?chapter=17_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信委托扣款相关 API-服务商模式"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/pap.php?chapter=17_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信委托扣款相关 API-普通商户模式"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/wxfacepay/develop/backend.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信刷脸支付 API"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/deposit_sl.php?chapter=26_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信酒店押金相关 API"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"支付方式与支付工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支付方式与支付工具","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付方式与支付工具")]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("IJPay 中支持的支付方式以及支付工具")])]),t._v(" "),s("ol",[s("li",[t._v("付款码支付【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=5_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/micropay_sl.php?chapter=5_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("公众号支付(JSAPI 支付)【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi_sl.php?chapter=7_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("扫码支付(Native 支付)【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/native_sl.php?chapter=6_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("APP支付【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app_sl.php?chapter=8_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("H5 支付【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/H5_sl.php?chapter=15_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("小程序支付【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_3&index=1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_sl_api.php?chapter=7_3&index=1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("人脸支付   【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/wxfacepay/",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("企业付款到零钱/银行卡 【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】")]),t._v(" "),s("li",[t._v("现金红包  【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/tools/cash_coupon.php?chapter=13_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("商户模式"),s("OutboundLink")],1),t._v("】【"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/tools/cash_coupon_sl.php?chapter=13_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务商模式"),s("OutboundLink")],1),t._v("】")])]),t._v(" "),s("h2",{attrs:{id:"使用步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用步骤")]),t._v(" "),s("ol",[s("li",[s("router-link",{attrs:{to:"/guide/maven.html"}},[t._v("添加相关依赖")])],1),t._v(" "),s("li",[t._v("找到相关支付方式的接口文档。构建请求参数 Model，并使用 https 执行请求")]),t._v(" "),s("li",[t._v("调用支付接口唤起支付并完成支付逻辑")])]),t._v(" "),s("h2",{attrs:{id:"微信支付-model"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信支付-model","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信支付 Model")]),t._v(" "),s("p",[t._v("IJPay 中常用支付方式涉及到的 "),s("a",{attrs:{href:"https://gitee.com/javen205/IJPay/blob/master/IJPay-WxPay/src/main/java/com/ijpay/wxpay/model",target:"_blank",rel:"noopener noreferrer"}},[t._v("Model"),s("OutboundLink")],1),t._v("\n都是使用 "),s("code",[t._v("builder")]),t._v(" 模式来构建，"),s("strong",[t._v("其中 Model 每个字段与官方接口文档保持一致")]),t._v("，同时支持商户模式、服务商模式。")]),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",[t._v("为什么要使用 Lombok 来构建接口的请求参数？")]),t._v(" "),s("p",[t._v("1、使用 Lombok 来构建请求参数是为了方便，不用写太多的冗余 get set。")]),t._v(" "),s("p",[t._v("2、避免手动设置误写参数导致的低级错误。")]),t._v(" "),s("p",[t._v("外界对 Lombok 的评价也不太一致，喜欢的非常喜欢不喜欢的就使劲吐槽，那么 IJPay 中有其他的替代方案吗？")]),t._v(" "),s("p",[t._v("当然是有的，最简单粗暴的方法使用 Map 来构建请求参数，再使用 "),s("code",[t._v("WxPayKit.buildSign")]),t._v(" 来构建签名即可。 IJPay 1.x 版本就是这么做的")])]),t._v(" "),s("h2",{attrs:{id:"扩展-model"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩展-model","aria-hidden":"true"}},[t._v("#")]),t._v(" 扩展 Model")]),t._v(" "),s("p",[t._v("由于支付方式的不同涉及到的接口非常多，如果某些接口的 Model 在 IJPay 没有提供封装，大家可以继承 "),s("a",{attrs:{href:"https://gitee.com/javen205/IJPay/blob/master/IJPay-Core/src/main/java/com/ijpay/core/model/BaseModel.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("BaseModel"),s("OutboundLink")],1),t._v(" "),s("strong",[t._v("所有属性字段名称与接口参数保持一致且必须为 "),s("code",[t._v("String")]),t._v(" 类型")]),t._v("，最后添加如下注解来实现 "),s("code",[t._v("builder")]),t._v(" 模式。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Builder")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@AllArgsConstructor")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Getter")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Setter")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CloseOrderModel")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BaseModel")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 属性字段名称与接口参数保持一致 ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" appid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 省略接口中的其他参数...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("前方高能")]),t._v(" "),s("ol",[s("li",[t._v("扩展 Model 必须继承  BaseModel")]),t._v(" "),s("li",[t._v("所有属性字段名称与接口参数保持一致且必须为 "),s("code",[t._v("String")]),t._v(" 类型")]),t._v(" "),s("li",[t._v("必须添加 "),s("a",{attrs:{href:"https://projectlombok.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lombok"),s("OutboundLink")],1),t._v(" 注解\n"),s("code",[t._v("@Builder")]),s("br"),t._v(" "),s("code",[t._v("@AllArgsConstructor(access = AccessLevel.PRIVATE)")]),t._v(" "),s("code",[t._v("@Getter")])]),t._v(" "),s("li",[t._v("IDEA 必须安装 "),s("a",{attrs:{href:"https://projectlombok.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lombok"),s("OutboundLink")],1),t._v(" 插件")])])]),t._v(" "),s("h2",{attrs:{id:"构建参数并执行请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建参数并执行请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 构建参数并执行请求")]),t._v(" "),s("ol",[s("li",[t._v("根据接口需要的参数，使用 Model 构建除 "),s("code",[t._v("sign")]),t._v(" 以外的参数")]),t._v(" "),s("li",[s("code",[t._v("build")]),t._v(" 后根据接口的签名方式创建签名 "),s("code",[t._v("creatSign")])]),t._v(" "),s("li",[t._v("使用 "),s("a",{attrs:{href:"https://gitee.com/javen205/IJPay/blob/master/IJPay-WxPay/src/main/java/com/ijpay/wxpay/WxPayApi.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("WxPayApi"),s("OutboundLink")],1),t._v(" 提供的接口执行 https 请求")]),t._v(" "),s("li",[t._v("构建支付参数唤起支付")])]),t._v(" "),s("p",[t._v("例如公众号支付(JSAPI 支付)的统一下单")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 统一下单构建请求参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" params "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnifiedOrderModel")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wxPayBean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAppId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mch_id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wxPayBean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMchId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nonce_str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayKit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("generateStr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"IJPay 让支付触手可及"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("attach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node.js 版:https://gitee.com/javen205/TNWX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("out_trade_no")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayKit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("generateStr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("total_fee")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("spbill_create_ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify_url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wxPayBean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDomain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("concat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/wxpay/pay_notify"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trade_type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TradeType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("JSAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTradeType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("openid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("openId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同时支持 SignType.MD5、SignType.HMACSHA256")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("creatSign")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wxPayBean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPartnerKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SignType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HMACSHA256"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" xmlResult "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayApi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pushOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将请求返回的 xml 数据转为 Map，方便后面逻辑获取数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" resultMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayKit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xmlToMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xmlResult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断返回的结果")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" returnCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resultMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"return_code"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" returnMsg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resultMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"return_msg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayKit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("codeIsOk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AjaxResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addError")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" resultCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resultMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"result_code"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayKit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("codeIsOk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resultCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AjaxResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addError")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以下字段在return_code 和result_code都为SUCCESS的时候有返回")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" prepayId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resultMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prepay_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 二次签名，构建公众号唤起支付的参数,这里的签名方式要与上面统一下单请求签名方式保持一致")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" packageParams "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayKit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepayIdCreateSign")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prepayId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    wxPayBean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAppId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("wxPayBean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPartnerKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SignType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HMACSHA256"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将二次签名构建的数据返回给前端并唤起公众号支付")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" jsonStr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" JSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toJSONString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("packageParams"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AjaxResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jsonStr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br")])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("完整示例")]),t._v(" "),s("p",[t._v("公众号"),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_7&index=6",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何唤起支付"),s("OutboundLink")],1),t._v("，完整示例请参考 "),s("a",{attrs:{href:"https://gitee.com/javen205/IJPay/blob/master/IJPay-Demo-SpringBoot/src/main/java/com/ijpay/demo/controller/wxpay/WxPayController.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("IJPay-Demo"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"多应用支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多应用支持","aria-hidden":"true"}},[t._v("#")]),t._v(" 多应用支持")]),t._v(" "),s("p",[t._v("微信支付的多应用支持方式与支付宝的多应用无缝切换一致，请参考 "),s("router-link",{attrs:{to:"/guide/alipay/init.html"}},[t._v("支付宝初始化")])],1),t._v(" "),s("h2",{attrs:{id:"完整示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完整示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 完整示例")]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("IJPay 2.x 版本示例")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://gitee.com/javen205/IJPay/tree/master/IJPay-Demo-SpringBoot",target:"_blank",rel:"noopener noreferrer"}},[t._v("IJPay-Demo-SpringBoot"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://gitee.com/javen205/IJPay/tree/master/IJPay-Demo-JFinal",target:"_blank",rel:"noopener noreferrer"}},[t._v("IJPay-Demo-JFinal"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("IJPay 1.x 版本示例")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://gitee.com/javen205/IJPay-Demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("IJPay-Demo"),s("OutboundLink")],1)])])])},[],!1,null,null,null);a.default=e.exports}}]);